Bootstrap: localimage
From: /home/edgar/research/chtc_apptainer/openmc_dagmc/dagmc_base.sif

%arguments
    DAGMC_BUILD_DIR=/root/DAGMC
    DAGMC_INSTALL_DIR=/opt/DAGMC
    MOAB_INSTALL_DIR=/opt/moab
    DAGMC_VERSION=v3.2.1
    DOUBLE_DOWN_INSTALL_DIR=/opt/double-down
    DOUBLE_DOWN_VERSION=v1.1.0
    CC=gcc
	CXX=g++
%post
    DAGMC_BUILD_DIR=/root/dagmc
    DAGMC_INSTALL_DIR=/opt/dagmc
    MOAB_INSTALL_DIR=/opt/moab
    MOAB_DIR={{MOAB_INSTALL_DIR}}
    echo $MOAB_DIR

    mkdir -p {{DAGMC_BUILD_DIR}}/build && \
    cd {{DAGMC_BUILD_DIR}} && \
    git clone -b {{DAGMC_VERSION}} --depth 1 https://github.com/svalinn/DAGMC.git &&\
    cd build && \
    cmake ../DAGMC \
        -DMOAB_DIR={{MOAB_INSTALL_DIR}} \
        -DBUILD_MW_REG_TESTS=OFF \
        -DBUILD_STATIC_EXE=OFF \
        -DBUILD_STATIC_LIBS=OFF
        -DCMAKE_C_COMPILER={{CC}} \
        -DCMAKE_CXX_COMPILER={{CXX}} \
        -DCMAKE_Fortran_COMPILER=gfortran \
        -DCMAKE_INSTALL_PREFIX={{DAGMC_INSTALL_DIR}} \
        -DDOUBLE_DOWN={{DOUBLE_DOWN_VERSION}} \
        -Ddd_ROOT={{DOUBLE_DOWN_INSTALL_DIR}} && \
    make -j18 && \
    make -j18 install